import{_ as r,r as l,o as t,c as i,a as s,b as o,F as p,d as a,e}from"./app.12051b04.js";const c={},k=s("h1",{id:"data-wrangling-with-data-table",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#data-wrangling-with-data-table","aria-hidden":"true"},"#"),a(" Data wrangling with data.table")],-1),y={href:"https://rdatatable.gitlab.io/data.table",target:"_blank",rel:"noopener noreferrer"},h=s("strong",null,"data.table",-1),v=a(" (by Matt Dowle, Arun Srinivasan "),d=s("em",null,"et. al.",-1),u=a(") is a package written in C to make high-performance data wrangling tasks a breeze. Despite being incredibly powerful, it is dependency free and has a rock-solid API. "),m=s("strong",null,"data.table",-1),b=a(" code reliably works decades apart."),x=e(`<h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation" aria-hidden="true">#</a> Installation</h2><p>Before continuing, make sure that you have installed <strong>data.table</strong>. You only have to do this once (or as often as you want to update the package).</p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Install from CRAN</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">install.packages</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;data.table&quot;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Alternatively, you can install the latest development version</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># install.packages(&quot;data.table&quot;, repos = &quot;https://fastverse.r-universe.dev&quot;)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Once <strong>data.table</strong> is installed, don&#39;t forget to load it whenever you want to use it. Unlike Stata, you have to re-load a package every time you start a new R session.</p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Load data.table into our current R session</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">library</span><span style="color:var(--shiki-color-text);">(data.table)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>All of the examples in this section will use real-life 2014 New York air traffic data. You can use the following commands to import the dataset into both Stata and R.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">import delimited using </span><span style="color:var(--shiki-token-comment);">///</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-string-expression);">&quot;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># library(data.table) ## Don&#39;t forget to load the library</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fread(</span><span style="color:var(--shiki-token-string-expression);">&#39;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&#39;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h2 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction" aria-hidden="true">#</a> Introduction</h2>`,8),g=a("The "),w={href:"https://rdatatable.gitlab.io/data.table",target:"_blank",rel:"noopener noreferrer"},f=s("strong",null,"data.table",-1),_=e(" package centers around <em>data.tables</em>, which are highly efficient data frames that can be manipulated using the package&#39;s concise syntax. For example, say we have a data.table called <code>dat</code> (you can call it whatever you want). Then we can manipulate it by putting arguments into its square brackets, i.e. <code>dat[]</code>. The three main components of a <strong>data.table</strong> operation are <code>i</code>, <code>j</code>, and <code>by</code>, which go in the order <strong><code>dat[i, j, by]</code></strong>. Note you don&#39;t have to specify the latter two if you&#39;re not currently using them.",17),q=e("<ul><li><strong><code>i</code></strong>, the first component, selects the rows of the data.table that you&#39;ll be working with, like how in Stata the <code>if</code> or <code>in</code> command options let you refer to certain rows.</li><li><strong><code>j</code></strong>, the second component, both selects and operates on the columns of the data.table, like how in Stata the <code>keep</code> or <code>drop</code> commands select specific columns of your data, or how <code>generate</code> or <code>replace</code> create or modify columns in your data.</li><li><strong><code>by</code></strong>, the third component, gives the variable(s) designating groups that you&#39;ll be doing your calculations within, like how in Stata you can precede a command with <code>bysort</code>.</li></ul><p><strong>data.table</strong> uses these simple components very flexibly. The upshot is that you can perform complicated operations in a single line of concise <strong>data.table</strong> code, which may have required multiple commands in other languages or libraries to accomplish. But even if you aren&#39;t doing anything fancy, <strong>data.table</strong> has you covered with a stable set of functions that can be deployed on virtually any data wrangling task.</p><p>Like Stata, <strong>data.table</strong> also provides some special shortcut symbols for common operations. For example, <code>_N</code> in Stata is equivalent to <code>.N</code> in <strong>data.table</strong>, while <code>.(x1, x2)</code> is short for <code>list(x1, x2)</code>. We&#39;ll see more examples in cheatsheat that follows. But we do want to quickly highlight one special symbol in particular: <strong><code>.SD</code></strong> refers to the (<strong>S</strong>)ubset of (<strong>D</strong>)ata you&#39;re working with. This can be used to do complex within-group calculations when you have <code>by</code> specified. But more generally it&#39;s a way to perform operations on lots of columns with one line of code. By default, <code>.SD</code> refers to all columns in the dataset (excepting those in <code>by</code>). But you can specify the columns you want with the <code>.SDcols</code> argument. Again, we&#39;ll see a bunch of examples below.</p>",3),S=a("Finally, "),R=s("strong",null,"data.table",-1),D=a(" is extremely fast. It has long set the standard for in-memory data wrangling "),A={href:"https://h2oai.github.io/db-benchmark",target:"_blank",rel:"noopener noreferrer"},N=a("benchmarks"),T=a(" across a variety of libraries and languages. You will likely see an order(s) of magnitude performance difference as you compare the code chunks below. As a bonus for Stata users, who are used to operations changing a single dataset in memory, many "),I=s("strong",null,"data.table",-1),L=a(" operations can be done "),E=s("em",null,"in-place",-1),U=a(". This means that you don't have to (re)assign the result to a new "),M=s("strong",null,"data.table",-1),C=a(". In-place modifications are also very efficient, since they will only affect the parts you're actually changing, without wasting memory and time on the parts that aren't being changed. Any time in the below cheat sheet you see a function with the word "),Y=s("code",null,"set",-1),j=a(" in it, or the "),G=s("code",null,":=",-1),B=a(" operator, that's an in-place operation."),F=s("h2",{id:"data-i-o",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#data-i-o","aria-hidden":"true"},"#"),a(" Data I/O")],-1),H=a("Like Stata's "),O=s("code",null,".dta",-1),J=a(" file format, R has its own native "),W=s("code",null,".rds",-1),P=a(" storage format. (See also the "),K={href:"http://www.fstpackage.org/",target:"_blank",rel:"noopener noreferrer"},V=s("strong",null,"fst",-1),z=a(" package.) However, we generally recommend that users avoid native\u2014especially proprietary\u2014data types since they hamper interoperability and reproducibility. We'll hence concentrate on common open-source file types below. We'll make an exception for "),$=s("code",null,".dta",-1),Q=a(" given our target audience, but we still recommend avoiding it if possible. Note that all of the examples in this section will assume generic datasets."),X=e(`<h3 id="read-and-write-csv" tabindex="-1"><a class="header-anchor" href="#read-and-write-csv" aria-hidden="true">#</a> Read and write .csv</h3><p>Single file.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">import delimited using </span><span style="color:var(--shiki-token-string-expression);">&quot;file.csv&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">clear</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* import delimited using &quot;file.csv&quot;, clear colrange(1:2)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* ?</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">export delimited using </span><span style="color:var(--shiki-token-string-expression);">&quot;file.csv&quot;</span><span style="color:var(--shiki-color-text);">, replace</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fread(</span><span style="color:var(--shiki-token-string-expression);">&quot;file.csv&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat = fread(&quot;file.csv&quot;, select=c(&quot;col1&quot;,&quot;col2&quot;)) # or select=1:2</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat = fread(&quot;file.csv&quot;, drop=c(&quot;col3&quot;,&quot;col4&quot;)) # or drop=3:4</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">fwrite(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-string-expression);">&quot;file.csv&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>Read many files and append them together.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">local</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">files</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">dir</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;data/&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">files</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;*.csv&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">tempfile</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mytmpfile</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, replace empty</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">foreach</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">of local</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">files</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">qui:</span><span style="color:var(--shiki-color-text);"> import delimited </span><span style="color:var(--shiki-token-string-expression);">&quot;data/\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-token-string-expression);">&#39;&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">case</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">preserve</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">append</span><span style="color:var(--shiki-color-text);"> using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, replace</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">files </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dir</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;data/&quot;</span><span style="color:var(--shiki-color-text);">, pattern</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;.csv&quot;</span><span style="color:var(--shiki-color-text);">, full.names</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rbindlist(lapply</span><span style="color:var(--shiki-token-punctuation);">(files, fread</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="read-and-write-dta" tabindex="-1"><a class="header-anchor" href="#read-and-write-dta" aria-hidden="true">#</a> Read and write .dta</h3>`,6),Z={class:"code--container"},ss=s("div",null,[s("p",null,[s("em",null,[a("Note: "),s("code",null,".dta"),a(" is Stata's native (proprietary) filetype.")])])],-1),as=a("Note: These commands require the "),ns={href:"https://haven.tidyverse.org/",target:"_blank",rel:"noopener noreferrer"},os=s("strong",null,"haven",-1),es=a(" package."),rs=e(`<p>Single file.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">use</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;file.dta&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* use &quot;file.dta&quot;, keep(var1-var4) clear</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;file.dta&quot;</span><span style="color:var(--shiki-color-text);">, replace</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> haven</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-function);">read_dta(</span><span style="color:var(--shiki-token-string-expression);">&quot;file.dta&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat = haven::read_dta(&quot;file.dta&quot;, col_select=var1:var4)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setDT(</span><span style="color:var(--shiki-token-punctuation);">dat</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># i.e. Set as a data.table</span></span>
<span class="line"><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">haven</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-function);">write_dta(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-string-expression);">&quot;file.dta&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>Read many files and append them together.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">cd</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;\`</span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-comment);">(pwd)</span><span style="color:var(--shiki-token-string-expression);">&#39;/data&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">append</span><span style="color:var(--shiki-color-text);"> using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">dir</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;.&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">files</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;*.dta&quot;&#39;</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">files </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dir</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;data/&quot;</span><span style="color:var(--shiki-color-text);">, pattern</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;.dta&quot;</span><span style="color:var(--shiki-color-text);">, full.names</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rbindlist(lapply</span><span style="color:var(--shiki-token-punctuation);">(files, haven</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-punctuation);">read_dta</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="read-and-write-parquet" tabindex="-1"><a class="header-anchor" href="#read-and-write-parquet" aria-hidden="true">#</a> Read and write .parquet</h3>`,5),ls={class:"code--container"},ts=s("div",null,[s("p",null,[s("em",null,"Note: Stata currently has limited support for parquet files (and Linux/Unix only).")])],-1),is=a("Note: These commands require the "),ps={href:"https://arrow.apache.org/docs/r/",target:"_blank",rel:"noopener noreferrer"},cs=s("strong",null,"arrow",-1),ks=a(" package."),ys=e(`<div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* See: https://github.com/mcaceresb/stata-parquet</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">files </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dir</span><span style="color:var(--shiki-color-text);">(pattern </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;.parquet&quot;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rbindlist(lapply</span><span style="color:var(--shiki-token-punctuation);">(files, arrow</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-punctuation);">read_parquet</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat = rbindlist(lapply(files, arrow::read_parquet, col_select=1:10))</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">write_parquet(</span><span style="color:var(--shiki-token-punctuation);">dat, sink </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;file.parquet&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><h3 id="create-a-dataset-de-novo" tabindex="-1"><a class="header-anchor" href="#create-a-dataset-de-novo" aria-hidden="true">#</a> Create a dataset <em>de novo</em></h3><p>Random numbers. Note that the random seeds will be different across the two languages.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">set</span><span style="color:var(--shiki-color-text);"> seed </span><span style="color:var(--shiki-token-constant);">123</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">set</span><span style="color:var(--shiki-color-text);"> obs </span><span style="color:var(--shiki-token-constant);">10</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> _n</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> y </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rnormal</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> z </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">runiform</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">set.seed</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">123</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">data.table(</span><span style="color:var(--shiki-token-punctuation);">x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-token-punctuation);">, y </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">rnorm</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, z </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">runif</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><p>Some convenience functions for specific data types.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* All combinations of two vectors (i.e. a cross-join)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">set</span><span style="color:var(--shiki-color-text);"> obs </span><span style="color:var(--shiki-token-constant);">10</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> _n in </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-token-constant);">2</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> yr </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">2000</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> _n</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">fillin</span><span style="color:var(--shiki-color-text);"> id yr</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">.</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-color-text);"> yr </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Datetimes</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* ?</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># All combinations of two vectors (i.e. a cross-join)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">CJ(</span><span style="color:var(--shiki-token-punctuation);">id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-token-punctuation);">, yr </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-constant);">2001</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">2010</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Datetime</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dts </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Sys.time</span><span style="color:var(--shiki-color-text);">() </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># time right now ++10 seconds</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">IDateTime(</span><span style="color:var(--shiki-token-punctuation);">dts</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><h2 id="order" tabindex="-1"><a class="header-anchor" href="#order" aria-hidden="true">#</a> Order</h2><h3 id="sort-rows" tabindex="-1"><a class="header-anchor" href="#sort-rows" aria-hidden="true">#</a> Sort rows</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">sort</span><span style="color:var(--shiki-color-text);"> air_time </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">sort</span><span style="color:var(--shiki-color-text);"> air_time dest </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gsort</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);">air_time</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">setorder(</span><span style="color:var(--shiki-token-punctuation);">dat, air_time</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setorder(</span><span style="color:var(--shiki-token-punctuation);">dat, air_time, dest</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setorder(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-punctuation);">air_time</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><h3 id="sort-columns" tabindex="-1"><a class="header-anchor" href="#sort-columns" aria-hidden="true">#</a> Sort columns</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">order</span><span style="color:var(--shiki-color-text);"> month day</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">setcolorder(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;month&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;day&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="rename-columns" tabindex="-1"><a class="header-anchor" href="#rename-columns" aria-hidden="true">#</a> Rename columns</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* rename (old) (new) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">rename</span><span style="color:var(--shiki-color-text);"> arr_delay arrival_delay </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">rename</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">carrier origin</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">carrier_code origin_code</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">rename</span><span style="color:var(--shiki-color-text);"> arr_</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> arrival_</span><span style="color:var(--shiki-token-keyword);">*</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># setnames(dat, old = ..., new = ...) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">setnames(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;arrival_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setnames(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;carrier&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;origin&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;carrier_code&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;origin_code&#39;</span><span style="color:var(--shiki-color-text);">)) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setnames(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-function);">gsub</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;arr_&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;arrival_&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-function);">names</span><span style="color:var(--shiki-token-punctuation);">(dat</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><h2 id="subset" tabindex="-1"><a class="header-anchor" href="#subset" aria-hidden="true">#</a> Subset</h2><p>In newer versions of Stata, it&#39;s possible to keep multiple datasets in memory, or &quot;frames&quot; as Stata calls them. However, this still requires extra steps that would be unusual to users of other languages. It&#39;s also not the typical way that most peope use Stata. In contrast, keeping multiple datasets in memory is extremely common in R. Moreover, subsetting and collapsing operations don&#39;t overwrite your original dataset. The upshot is that you don&#39;t need to wrap everything in <code>preserve/restore</code>. However, it also means that you&#39;ll need to (re)assign your subsetted/collapsed data if you want to use it again later. E.g. <code>dat1 = dat[origin==&#39;LGA&#39;]</code>.</p><h3 id="subset-rows" tabindex="-1"><a class="header-anchor" href="#subset-rows" aria-hidden="true">#</a> Subset rows</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-token-constant);">200</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> day </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> day </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">10</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">inrange</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">day</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> origin </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;LGA&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">regexm</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-color-text);">&quot;</span><span style="color:var(--shiki-token-string-expression);">LGA</span><span style="color:var(--shiki-color-text);">&quot;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">inlist</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">month</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">4</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">11</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">12</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">inlist</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&quot;JFK&quot;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&quot;LGA&quot;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> month </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">200</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[day </span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> day </span><span style="color:var(--shiki-token-keyword);">&lt;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[</span><span style="color:var(--shiki-token-function);">between(</span><span style="color:var(--shiki-token-punctuation);">day,</span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span><span style="color:var(--shiki-token-comment);"># Or: dat[day %in% 5:10] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[origin</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">&#39;LGA&#39;</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[origin </span><span style="color:var(--shiki-token-keyword);">%like%</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;LGA&#39;</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[month </span><span style="color:var(--shiki-token-keyword);">%in%</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">4</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">11</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">12</span><span style="color:var(--shiki-color-text);">)] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[origin </span><span style="color:var(--shiki-token-keyword);">%chin%</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;JFK&quot;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&quot;LGA&quot;</span><span style="color:var(--shiki-color-text);">)] </span><span style="color:var(--shiki-token-comment);"># %chin% is a fast %in% for (ch)aracters </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[month</span><span style="color:var(--shiki-token-keyword);">!=</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><h3 id="subset-columns" tabindex="-1"><a class="header-anchor" href="#subset-columns" aria-hidden="true">#</a> Subset columns</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> month day carrier</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">month, day, carrier</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-color-text);">(month, day, carrier)]    </span><span style="color:var(--shiki-token-comment);"># another option</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;month&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;day&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;carrier&#39;</span><span style="color:var(--shiki-color-text);">)] </span><span style="color:var(--shiki-token-comment);"># and another</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> year</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);">arr_delay</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">_delay </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, year</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);">arr_delay] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, .SD, .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;*_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> origin dest </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">ds</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">type</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">string</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">r</span><span style="color:var(--shiki-token-comment);">(varlist)</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">ds</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">type</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">int</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">r</span><span style="color:var(--shiki-token-comment);">(varlist)</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;origin&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">)]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;origin&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NULL</span><span style="color:var(--shiki-color-text);">] </span><span style="color:var(--shiki-token-comment);"># same, but in-place </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Matches the two lines on the left:</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, .SD, .SDcols</span><span style="color:var(--shiki-token-keyword);">=!</span><span style="color:var(--shiki-color-text);">is.character] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Matches the two lines on the left: </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, .SD, .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">is.integer]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div><h3 id="subset-rows-and-columns" tabindex="-1"><a class="header-anchor" href="#subset-rows-and-columns" aria-hidden="true">#</a> Subset rows and columns</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> origin </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;LGA&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> month day carrier</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Matches the two lines on the left:</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[origin</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">&quot;LGA&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">month, day, carrier</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="drop-duplicates" tabindex="-1"><a class="header-anchor" href="#drop-duplicates" aria-hidden="true">#</a> Drop duplicates</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">duplicates</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">drop</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">duplicates</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> month day carrier, force</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">unique</span><span style="color:var(--shiki-color-text);">(dat) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">unique</span><span style="color:var(--shiki-color-text);">(dat, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;month&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;day&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;carrier&#39;</span><span style="color:var(--shiki-color-text);">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="drop-missing" tabindex="-1"><a class="header-anchor" href="#drop-missing" aria-hidden="true">#</a> Drop missing</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">dest</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Requires: ssc inst missings</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">missings dropvars, force </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">missings air_time dest, force </span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">is.na</span><span style="color:var(--shiki-color-text);">(dest)]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">na.omit</span><span style="color:var(--shiki-color-text);">(dat) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">na.omit</span><span style="color:var(--shiki-color-text);">(dat, cols </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;air_time&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">)) </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat[!is.na(air_time) &amp; !is.na(dest)] # same</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div><h2 id="modify" tabindex="-1"><a class="header-anchor" href="#modify" aria-hidden="true">#</a> Modify</h2><p><strong>Aside:</strong> You can force print a data.table&#39;s in-place modifications to screen by adding a trailing <code>[]</code>, e.g. <code>dat[, dist_sq := distance^2][]</code>.</p><h3 id="create-new-variables" tabindex="-1"><a class="header-anchor" href="#create-new-variables" aria-hidden="true">#</a> Create new variables</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> dist_sq </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> tot_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dep_delay </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> arr_delay </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> first_letter </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">substr</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> flight_path </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> &#39;_&#39; </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> dest </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, dist_sq </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, tot_delay </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> dep_delay </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> arr_delay] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, first_letter </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">substr</span><span style="color:var(--shiki-color-text);">(origin,</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, flight_path </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">paste</span><span style="color:var(--shiki-color-text);">(origin, dest, sep</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;_&#39;</span><span style="color:var(--shiki-color-text);">)] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><p>Here are some <strong>data.table</strong> modifying operations that don&#39;t have direct Stata equivalents (although you could implement a loop).</p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Multiple variables can be created at once. These next few lines all do the </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># same thing. Just pick your favourite. </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;dist_sq&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;dist_cu&#39;</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-token-punctuation);">, distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-string-expression);">&#39;:=&#39;</span><span style="color:var(--shiki-color-text);"> (dist_sq</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">, dist_cu</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">)]        </span><span style="color:var(--shiki-token-comment);"># &quot;functional&quot; equivalent </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">let(</span><span style="color:var(--shiki-token-punctuation);">dist_sq</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);">distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-token-punctuation);">, dist_cu</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);">distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]          </span><span style="color:var(--shiki-token-comment);"># dev version only</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># We can also chain back-to-back with &quot;dat[...][...]&quot; (this holds for any </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># data.table operation) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, dist_sq </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> distance</span><span style="color:var(--shiki-token-keyword);">^</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">][</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    , dist_cu </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> distance</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">dist_sq]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="create-new-variables-within-groups" tabindex="-1"><a class="header-anchor" href="#create-new-variables-within-groups" aria-hidden="true">#</a> Create new variables within groups</h3><p><strong>Aside:</strong> In R, any missing (i.e. &quot;NA&quot;) values will propagate during aggregating functions. If you have <code>NA</code> values in your real-life dataset\u2014we don&#39;t in this example dataset\u2014you probably want to add <code>na.rm=TRUE</code> to remove these on the fly. E.g. <code>mean(var1, na.rm=TRUE)</code> or <code>lapply(.SD, mean, na.rm=TRUE)</code>.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> origin</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> mean_dep_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">dep_delay</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> origin dest</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> mean_dep_delay2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">dep_delay</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, mean_dep_delay </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(dep_delay), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">origin] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, mean_dep_delay2 </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(dep_delay), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">origin,dest</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><p>Some shortcut symbols.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">gen index _n</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> carrier</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> index_within_carrier </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> _n </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> carrier</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> rows_per_carrier </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> _N </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> origin_index </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">group</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, index </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> .I]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, index_within_carrier </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rowid(</span><span style="color:var(--shiki-token-punctuation);">carrier</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, rows_per_carrier </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> .N, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> carrier]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, origin_index </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> .GRP, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><p>Multiple grouped variables (manual demean example).</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">foreach</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">of varlist</span><span style="color:var(--shiki-color-text);"> dep_delay arr_delay air_time </span><span style="color:var(--shiki-token-keyword);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> mean_</span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">), </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">_dm </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> mean_</span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> mean</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dmcols </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;air_time&#39;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">paste0</span><span style="color:var(--shiki-color-text);">(dmcols,</span><span style="color:var(--shiki-token-string-expression);">&#39;_dm&#39;</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, \\(x) x</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(x)),</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    .SDcols </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dmcols,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Note: \`\\(x)\` is a shorthand for \`function(x)\`, introduced </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># in R 4.1.1. You&#39;ll need to use the latter if you&#39;re still </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># on an older version of R.</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><p>Relative modification (i.e. refer to other rows)</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* This will be easier to demonstrate with a collapsed </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* dataset: Grab the total monthly flights out of each </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* origin airport. (Don&#39;t forget preserve/restore!)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">contract</span><span style="color:var(--shiki-color-text);"> origin month, </span><span style="color:var(--shiki-token-function);">freq</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">N</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">sort</span><span style="color:var(--shiki-color-text);"> origin month</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Ex. 1: Simple month-on-month growth</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">by</span><span style="color:var(--shiki-color-text);"> origin</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> growth </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> N/N[_n</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Ex. 2: Relative growth</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">by</span><span style="color:var(--shiki-color-text);"> origin</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> growth_since_first </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> N/N[</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Ex. 3: Relative growth (order agnostic)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> origin </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">month</span><span style="color:var(--shiki-token-keyword);">):</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> growth_since_may </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">max</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">N</span><span style="color:var(--shiki-token-keyword);">*(</span><span style="color:var(--shiki-token-parameter);">month</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> growth_since_may </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> N </span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-color-text);"> growth_since_may</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># This will be easier to demonstrate with a collapsed </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dataset: Grab the total monthly flights out of each </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># origin airport.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dat[, .N, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">origin, month</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setorder(</span><span style="color:var(--shiki-token-punctuation);">dat2, origin, month</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Ex. 1: Simple month-on-month growth</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat2[, growth </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> N</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-token-function);">shift(</span><span style="color:var(--shiki-token-punctuation);">N, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Ex. 2: Relative growth</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat2[, growth_since_first </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> N</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-color-text);">N[</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">], by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Ex. 3: Relative growth (order agnostic)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat2[, growth_since_may </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> N</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-color-text);">N[month</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-constant);">5</span><span style="color:var(--shiki-color-text);">], by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div></div><h3 id="work-with-dates" tabindex="-1"><a class="header-anchor" href="#work-with-dates" aria-hidden="true">#</a> Work with dates</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Make a date variable</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">tostring</span><span style="color:var(--shiki-color-text);"> year month day, replace</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> day_string </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> year </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;/&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> month </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;/&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> day</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">day_string</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;YMD&quot;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">format</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">%</span><span style="color:var(--shiki-color-text);">td</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Pull out year (quarter, month, etc. work too)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> the_year </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">year</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">date</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Shift forward 7 days</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">7</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Make a date variable</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, date </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">as.IDate(paste</span><span style="color:var(--shiki-token-punctuation);">(year, month, day, sep</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;-&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)] </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Pull out year (quarter, month, etc. work too)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, the_year </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">year(</span><span style="color:var(--shiki-token-punctuation);">date</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Shift forward 7 days</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, date </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">7</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><h3 id="modify-existing-variables" tabindex="-1"><a class="header-anchor" href="#modify-existing-variables" aria-hidden="true">#</a> Modify existing variables</h3><p><strong>Aside:</strong> We don&#39;t normally use a gen -&gt; replace workflow in R, the way we do in Stata. See the <a href="#using-booleans-control-flow">Using Booleans &amp; control-flow</a> section below for a more idiomatic approach.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> tot_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dep_delay </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> arr_delay </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Conditional modification </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> distance </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> distance </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> month</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-constant);">9</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> distance </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);"> in </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Modify multiple variables (same function) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">foreach</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">of varlist</span><span style="color:var(--shiki-color-text);"> origin dest </span><span style="color:var(--shiki-token-keyword);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot; Airport&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, tot_delay </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> dep_delay </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> arr_delay] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Conditional modification </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[month</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-constant);">9</span><span style="color:var(--shiki-color-text);">, distance </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> distance </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">, distance </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Modify multiple variables (same function) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">cols </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;origin&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, (cols) </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, \\(x) </span><span style="color:var(--shiki-token-function);">paste</span><span style="color:var(--shiki-color-text);">(x,</span><span style="color:var(--shiki-token-string-expression);">&#39;Airport&#39;</span><span style="color:var(--shiki-color-text);">)), </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    .SDcols </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> cols] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div></div><h3 id="using-booleans-control-flow" tabindex="-1"><a class="header-anchor" href="#using-booleans-control-flow" aria-hidden="true">#</a> Using Booleans &amp; control-flow</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> long_flight </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> air_time</span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">air_time</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> flight_length </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;Long&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> air_time</span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">air_time</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> flight_length </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;Short&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">flight_length</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">&amp;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">air_time</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> flight_length2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;Long&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">air_time</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> flight_length2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;Med&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> air_time</span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-color-text);">  </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> flight_length2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;Short&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> air_time</span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-token-constant);">120</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, long_flight </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> air_time</span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, flight_length </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fifelse(</span><span style="color:var(--shiki-token-punctuation);">air_time</span><span style="color:var(--shiki-token-keyword);">&gt;</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;Long&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;Short&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># fifelse is like base-R ifelse, but (f)aster! </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># for nested ifelse, easier to use fcase </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, flight_length2 </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fcase(</span><span style="color:var(--shiki-token-punctuation);">air_time</span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-token-constant);">120</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;Short&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">                              air_time</span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-token-constant);">500</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;Med&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">                              default </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;Long&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><h3 id="row-wise-calculations" tabindex="-1"><a class="header-anchor" href="#row-wise-calculations" aria-hidden="true">#</a> Row-wise calculations</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Pre-packaged row calculations: </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> tot_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rowtotal</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-token-parameter);">_delay</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> any_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rowfirst</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-token-parameter);">_delay</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Custom row calculations:</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* ?</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Pre-packaged row calculations: </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, tot_delay </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rowSums</span><span style="color:var(--shiki-color-text);">(.SD), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;*_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, any_delay </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fcoalesce(</span><span style="color:var(--shiki-token-punctuation);">.SD</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;*_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Custom row calculations: </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, new_var </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mapply</span><span style="color:var(--shiki-color-text);">(custom_func, var1, var2)] </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, new_var </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">custom_func(</span><span style="color:var(--shiki-token-punctuation);">var1, var2</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">.I] </span><span style="color:var(--shiki-token-comment);"># dev version only</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><h3 id="fill-in-time-series-panel-data" tabindex="-1"><a class="header-anchor" href="#fill-in-time-series-panel-data" aria-hidden="true">#</a> Fill in Time Series/Panel Data</h3><p>Lags and leads (generic dataset)</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Create generic dataset for this section</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">set</span><span style="color:var(--shiki-color-text);"> obs  </span><span style="color:var(--shiki-token-constant);">12</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">seq</span><span style="color:var(--shiki-color-text);">(), </span><span style="color:var(--shiki-token-function);">from</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">to</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">block</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">4</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> id</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> yr </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">2000</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> _n</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> y </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">runiform</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Lag(s)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">yr</span><span style="color:var(--shiki-token-keyword);">):</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> xlag </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> x[_n</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Lead(s)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">yr</span><span style="color:var(--shiki-token-keyword);">):</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> xlead </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> x[_n</span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Create generic dataset for this section</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">CJ(</span><span style="color:var(--shiki-token-punctuation);">id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-token-punctuation);">, yr </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-constant);">2001</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">2004</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">[, x </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">runif</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">12</span><span style="color:var(--shiki-color-text);">)]</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># setorder(dat, id, yr) # already ordered</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Lag(s)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, xlag </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">shift(</span><span style="color:var(--shiki-token-punctuation);">x, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> id]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Lead(s)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, xlead </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">shift(</span><span style="color:var(--shiki-token-punctuation);">x, </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> id]</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat[ , xlead := shift(x, 1, type=&quot;lead&quot;), by = id] # same</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div></div><p>Replace missing values forward or back (generic dataset)</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Modify our dataset from above...</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">drop</span><span style="color:var(--shiki-color-text);"> xlag xlead</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">.</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">inlist</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">yr</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">2001</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">2003</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Carry forward the last-known observation</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* sort id yr * already sorted</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">by</span><span style="color:var(--shiki-color-text);"> id</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> x[_n</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">] </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Carry back the next-known observation</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gsort</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);">yr</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">by</span><span style="color:var(--shiki-color-text);"> id</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">replace</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> x[_n</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">] </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">missing</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Modify our dataset from above...</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;xlag&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;xlead&quot;</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NULL</span><span style="color:var(--shiki-color-text);">][</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    yr </span><span style="color:var(--shiki-token-keyword);">%in%</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">2001</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-constant);">2003</span><span style="color:var(--shiki-color-text);">), x </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">NA</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Carry forward the last-known observation</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># setorder(dat, id, yr) # already ordered</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, x </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">nafill(</span><span style="color:var(--shiki-token-punctuation);">x, type </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;locf&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> id]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Carry back the next-known observation</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, x </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">nafill(</span><span style="color:var(--shiki-token-punctuation);">x, type </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;nocb&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> id]</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><h2 id="collapse" tabindex="-1"><a class="header-anchor" href="#collapse" aria-hidden="true">#</a> Collapse</h2><p>In newer versions of Stata, it&#39;s possible to keep multiple datasets in memory, or &quot;frames&quot; as Stata calls them. However, this still requires extra steps that would be unusual to users of other languages. It&#39;s also not the typical way that most peope use Stata. In contrast, keeping multiple datasets in memory is extremely common in R. Moreover, subsetting and collapsing operations don&#39;t overwrite your original dataset. The upshot is that you don&#39;t need to wrap everything in <code>preserve/restore</code>. However, it also means that you&#39;ll need to (re)assign your subsetted/collapsed data if you want to use it again later. E.g. <code>dat1 = dat[, mean(var1)]</code>. Finally, remember our earlier note about aggregating functions on columns that have missing values: Use <code>na.rm=TRUE</code> to remove these on the fly. E.g. <code>dat[, mean(var1, na.rm=TRUE)]</code>.</p><h3 id="collapse-with-no-grouping" tabindex="-1"><a class="header-anchor" href="#collapse-with-no-grouping" aria-hidden="true">#</a> Collapse with no grouping</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> dep_delay </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(dep_delay)] </span><span style="color:var(--shiki-token-comment);"># returns a scalar</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> mean_ddel </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dep_delay </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">mean_ddel </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(dep_delay</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)] </span><span style="color:var(--shiki-token-comment);"># returns a data.table</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> mean_ddel</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">dep_delay mean_adel</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">arr_delay </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># These lines all do the same thing. Just pick your favourite.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">mean_ddel</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(dep_delay</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, mean_adel</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(arr_delay))]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-color-text);">)]</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">arr_delay</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);">dep_delay]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">delay </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">ds</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">type</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">long</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">r</span><span style="color:var(--shiki-token-comment);">(varlist)</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># Matches the two lines on the left</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">is.numeric]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="collapse-by-group" tabindex="-1"><a class="header-anchor" href="#collapse-by-group" aria-hidden="true">#</a> Collapse by group</h3><div class="code--container"><div><p><em>Reminder: You&#39;ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p></div><div><p><em>Reminder: You&#39;ll need to (re)assign the subsetted dataset if you want to use it later, e.g. <code>dat1 = dat[...]</code>.</em></p></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> arr_delay, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">carrier</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* collapse (mean) V1 = arr_delay, by(carrier)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">arr_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(arr_delay</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">carrier] </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># dat[, mean(arr_delay), by=carrier] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> arr_delay, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">carrier</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">month</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">arr_delay </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(arr_delay</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">carrier, month</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">min</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> min_d</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">distance </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">max</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> max_d</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">distance, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">min_d</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">min</span><span style="color:var(--shiki-token-punctuation);">(distance</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, max_d</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">max</span><span style="color:var(--shiki-color-text);">(distance)), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">origin] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">_delay, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">origin] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">ds</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">type</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">long</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">r</span><span style="color:var(--shiki-token-comment);">(varlist)</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># matches the two lines on the left</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">is.numeric, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">origin] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> dep_delay arr_delay air_time distance, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(.SD, mean), .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;air_time&#39;</span><span style="color:var(--shiki-color-text);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;distance&#39;</span><span style="color:var(--shiki-color-text);">), by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">origin] </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">#dat[, lapply(.SD, mean), .SDcols = c(4,5,9,10), by=origin] # same </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> unique_dest </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">tag</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">dest</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(sum)</span><span style="color:var(--shiki-color-text);"> unique_dest, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">origin</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Matches the final two lines on the left: </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">unique_dest </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">uniqueN(</span><span style="color:var(--shiki-token-punctuation);">dest</span><span style="color:var(--shiki-token-function);">))</span><span style="color:var(--shiki-color-text);">, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h3 id="count-rows" tabindex="-1"><a class="header-anchor" href="#count-rows" aria-hidden="true">#</a> Count rows</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">count</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">count</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> month</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-constant);">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Count rows by group:</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">tabulate</span><span style="color:var(--shiki-color-text);"> origin</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat[, .N] </span><span style="color:var(--shiki-token-comment);"># Or: nrow(dat) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[month</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">, .N] </span><span style="color:var(--shiki-token-comment);"># Or: nrow(dat[month==10]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Count rows by group:</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, .N, by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> origin]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><h3 id="advanced-collapse-tips-and-tricks" tabindex="-1"><a class="header-anchor" href="#advanced-collapse-tips-and-tricks" aria-hidden="true">#</a> Advanced collapse (tips and tricks)</h3><p>These next few examples are meant to highlight some specific <strong>data.table</strong> collapse tricks. They don&#39;t really have good Stata equivalents (that we&#39;re aware of).</p><h4 id="use-keys-for-even-faster-grouped-operations" tabindex="-1"><a class="header-anchor" href="#use-keys-for-even-faster-grouped-operations" aria-hidden="true">#</a> Use keys for even faster grouped operations</h4>`,78),hs=a("The "),vs=s("strong",null,"data.table",-1),ds=a(" website "),us={href:"https://rdatatable.gitlab.io/data.table/articles/datatable-keys-fast-subset.html",target:"_blank",rel:"noopener noreferrer"},ms=a("describes"),bs=a(' keys as "supercharged rownames". Essentially, '),xs=s("em",null,"setting a key",-1),gs=a(" means ordering your data in a way that makes it very efficient to do subsetting or aggregating operations. "),ws=s("strong",null,"data.table",-1),fs=a(" is already highly performant, but setting keys can give a valuable speed boost for big data tasks."),_s=e(`<div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">## Set keys. You normally want whatever you&#39;re grouping by</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setkey(</span><span style="color:var(--shiki-token-punctuation);">dat, month, origin</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">## Same collapse syntax as before, just faster</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(dep_delay), by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">month, origin</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">## Tip: Turn on automatic printing of keys. The dev version</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">## of data.table (v1.14.4) does this by default.</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">options</span><span style="color:var(--shiki-color-text);">(datatable.print.class </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">, datatable.print.keys </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">## Turn keys back off</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">setkey(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-constant);">NULL</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="grouped-calculations-and-complex-objects-inside-a-data-table" tabindex="-1"><a class="header-anchor" href="#grouped-calculations-and-complex-objects-inside-a-data-table" aria-hidden="true">#</a> Grouped calculations and complex objects inside a data.table</h4><p><strong>data.table</strong> supports list columns, so you can have complex objects like regression models inside a data.table. Among many other things, this means you can nest simulations inside a data.table as easily as you would perform any other (grouped) operation. Here we illustrate with a simple grouped regression, i.e. a separate regression for each month of our dataset.</p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Let&#39;s run a separate regression of arrival delay on </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># departure delay for each month _inside_ our data.table</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Just get the coefficients</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">beta </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">coef</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-token-punctuation);">(arr_delay </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> dep_delay, .SD</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)[</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-color-text);">]),</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> month]</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># As above, but now keep the whole model for each month</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># in a dedicated &quot;mod&quot; column</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">mods </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dat[,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">           </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">mod </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-token-punctuation);">(arr_delay </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> dep_delay, .SD)</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">),</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">           by </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> month] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Now you can do things like put all 10 models in a </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># regression table or coefficient plot. Here we use the</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># modelsummary package to do that.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">modelsummary</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-function);">msummary(</span><span style="color:var(--shiki-token-punctuation);">mods</span><span style="color:var(--shiki-token-keyword);">$</span><span style="color:var(--shiki-token-punctuation);">mod</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">modelsummary</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-function);">modelplot(</span><span style="color:var(--shiki-token-punctuation);">mods</span><span style="color:var(--shiki-token-keyword);">$</span><span style="color:var(--shiki-token-punctuation);">mod, coef_omit </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&#39;Inter&#39;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="grouped-aggregations-when-reshaping" tabindex="-1"><a class="header-anchor" href="#grouped-aggregations-when-reshaping" aria-hidden="true">#</a> Grouped aggregations when reshaping</h4><p>You can do complicated (grouped) aggregations as part of a <code>data.table::dcast()</code> (i.e. reshape wide) call. Here&#39;s an example where we summarise both the departure and arrival delays\u2014getting the minimum, mean, and maximum values\u2014by origin airport.</p><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">dcast(</span><span style="color:var(--shiki-token-punctuation);">dat, origin</span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);">., fun </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(min, mean, max),</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">      value.var </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="reshape" tabindex="-1"><a class="header-anchor" href="#reshape" aria-hidden="true">#</a> Reshape</h2><h3 id="reshape-prep-this-dataset-only" tabindex="-1"><a class="header-anchor" href="#reshape-prep-this-dataset-only" aria-hidden="true">#</a> Reshape prep (this dataset only)</h3><p><em>Note: We need to do a bit of prep to our air-traffic dataset to better demonstrate the reshape examples in this section. You probably don&#39;t need to do this for your own dataset.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* We&#39;ll generate row IDs to avoid the (reshape) ambiguity </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* of repeated entries per date </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> id </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> _n </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* For the Stata reshape, it&#39;s also going to prove </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* convenient to rename the delay vars. </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">rename</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">dep_delay arr_delay</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">delay_dep delay_arr</span><span style="color:var(--shiki-token-keyword);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># We&#39;ll generate row IDs to avoid the (reshape) ambiguity </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># of repeated entries per date </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, id </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> .I] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><h3 id="reshape-long" tabindex="-1"><a class="header-anchor" href="#reshape-long" aria-hidden="true">#</a> Reshape long</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">reshape</span><span style="color:var(--shiki-color-text);"> long delay_, </span><span style="color:var(--shiki-token-function);">i</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">id</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">j</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">delay_type</span><span style="color:var(--shiki-color-text);">) s</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">ldat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">melt(</span><span style="color:var(--shiki-token-punctuation);">dat, measure</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;_delay&#39;</span><span style="color:var(--shiki-token-function);">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside: you can also choose different names for your</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># new reshaped columns if you&#39;d like, e.g. </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">melt(</span><span style="color:var(--shiki-token-punctuation);">dat, measure</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">patterns(</span><span style="color:var(--shiki-token-string-expression);">&#39;_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-token-punctuation);">, variable</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;d_type&#39;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><h3 id="reshape-wide" tabindex="-1"><a class="header-anchor" href="#reshape-wide" aria-hidden="true">#</a> Reshape wide</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* This starts with the reshaped-long data from above</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">reshape</span><span style="color:var(--shiki-color-text);"> wide delay_, </span><span style="color:var(--shiki-token-function);">i</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">id</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">j</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">delay_type</span><span style="color:var(--shiki-color-text);">) s</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># This starts with the reshaped-long data from above</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">wdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dcast(</span><span style="color:var(--shiki-token-punctuation);">ldat, ... </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> variable</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside 1: If you only want to keep the id &amp; *_delay cols</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">dcast(</span><span style="color:var(--shiki-token-punctuation);">ldat, id </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> variable</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside 2: It&#39;s also possible to perform complex and </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># powerful data aggregating tasks as part of the dcast </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># (i.e. reshape wide) call.</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">dcast(</span><span style="color:var(--shiki-token-punctuation);">dat, origin</span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);">., fun</span><span style="color:var(--shiki-token-keyword);">=list</span><span style="color:var(--shiki-token-punctuation);">(min,mean,max),</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">      value.var</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;dep_delay&#39;</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-token-string-expression);">&#39;arr_delay&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><h2 id="merge" tabindex="-1"><a class="header-anchor" href="#merge" aria-hidden="true">#</a> Merge</h2><h3 id="import-and-prep-secondary-dataset" tabindex="-1"><a class="header-anchor" href="#import-and-prep-secondary-dataset" aria-hidden="true">#</a> Import and prep secondary dataset</h3><p><strong>Note:</strong> Our secondary dataset for demonstrating the merges in this section will be one on airport characteristics.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">import delimited using </span><span style="color:var(--shiki-token-string-expression);">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Stata requires that merge ID variables have the same </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* name across datasets.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">rename</span><span style="color:var(--shiki-color-text);"> faa dest</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Save as tempfile and then reimport original dataset</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">tempfile</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dat2</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">import delimited using </span><span style="color:var(--shiki-token-string-expression);">&quot;https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">fread(</span><span style="color:var(--shiki-token-string-expression);">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/nycflights13/airports.csv&quot;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># R _doesn&#39;t_ require that merge ID variables share the </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># same name across datasets. But we&#39;ll add this anyway.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat2[, dest </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> faa]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><h3 id="inner-merge" tabindex="-1"><a class="header-anchor" href="#inner-merge" aria-hidden="true">#</a> Inner merge</h3><p><em>Only keep the matched rows across both datasets.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">merge</span><span style="color:var(--shiki-color-text);"> m</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> dest using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">keep</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="full-merge" tabindex="-1"><a class="header-anchor" href="#full-merge" aria-hidden="true">#</a> Full merge</h3><p><em>Keep all rows of both datasets, regardless of whether matched.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">merge</span><span style="color:var(--shiki-color-text);"> m</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> dest using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">, all</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="left-merge" tabindex="-1"><a class="header-anchor" href="#left-merge" aria-hidden="true">#</a> Left merge</h3><p><em>Keep all rows from the &quot;main&quot; dataset.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">merge</span><span style="color:var(--shiki-color-text);"> m</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> dest using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">keep</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">, all.x</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="right-merge" tabindex="-1"><a class="header-anchor" href="#right-merge" aria-hidden="true">#</a> Right merge</h3><p><em>Keep all rows from the &quot;secondary&quot; dataset.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">merge</span><span style="color:var(--shiki-color-text);"> m</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> dest using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">keep</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2, by</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">, all.y</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="anti-merge" tabindex="-1"><a class="header-anchor" href="#anti-merge" aria-hidden="true">#</a> Anti merge</h3><p><em>Keep non-matched rows only.</em></p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">merge</span><span style="color:var(--shiki-color-text);"> m</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> dest using </span><span style="color:var(--shiki-color-text);">\`</span><span style="color:var(--shiki-token-function);">dat2</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">keep</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">) nogen</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> dat[</span><span style="color:var(--shiki-token-keyword);">!</span><span style="color:var(--shiki-color-text);">dat2, on</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h3 id="appending-data" tabindex="-1"><a class="header-anchor" href="#appending-data" aria-hidden="true">#</a> Appending data</h3><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* This just appends the flights data to itself</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> data_to_append.dta, replace</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">append</span><span style="color:var(--shiki-color-text);"> using data_to_append.dta</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># This just appends the flights data to itself</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">rbindlist(</span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(dat, dat)</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># Or rbind(dat, dat)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># The fill = TRUE option is handy if the one data set has columns the other doesn&#39;t</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><h3 id="advanced-merges-tips-and-tricks" tabindex="-1"><a class="header-anchor" href="#advanced-merges-tips-and-tricks" aria-hidden="true">#</a> Advanced merges (tips and tricks)</h3><p>These next few examples are meant to highlight some specific <strong>data.table</strong> merge tricks. They don&#39;t really have good Stata equivalents (that we&#39;re aware of).</p><h4 id="merge-on-different-id-names" tabindex="-1"><a class="header-anchor" href="#merge-on-different-id-names" aria-hidden="true">#</a> Merge on different ID names</h4><div class="code--container grid-cols-1"><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2, by.x</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;dest&#39;</span><span style="color:var(--shiki-color-text);">, by.y</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;faa&#39;</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h4 id="set-keys-for-even-faster-merges-and-syntax-shortcuts" tabindex="-1"><a class="header-anchor" href="#set-keys-for-even-faster-merges-and-syntax-shortcuts" aria-hidden="true">#</a> Set keys for even faster merges and syntax shortcuts</h4><div class="code--container grid-cols-1"><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">setkey(</span><span style="color:var(--shiki-token-punctuation);">dat, dest</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">; </span><span style="color:var(--shiki-token-function);">setkey(</span><span style="color:var(--shiki-token-punctuation);">dat2, dest</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">mdat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">merge</span><span style="color:var(--shiki-color-text);">(dat, dat2) </span><span style="color:var(--shiki-token-comment);">## note: don&#39;t need &#39;by&#39; </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h4 id="non-equi-joins" tabindex="-1"><a class="header-anchor" href="#non-equi-joins" aria-hidden="true">#</a> Non-equi joins</h4><p>Non-equi joins are a bit hard to understand if you&#39;ve never seen them before. But they are incredibly powerful and solve a surprisingly common problem: Merging datasets over a range (e.g. start to end dates), rather than exact matches. Here&#39;s a simple example where we want to subset the 1st quarter flights for American Airlines and the 2nd quarter flights for United Airlines:</p><div class="code--container grid-cols-1"><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># The things we want to match on. Note the different start and</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># end months for AA and UA.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat3 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">data.table(</span><span style="color:var(--shiki-token-punctuation);">carrier     = </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;AA&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;UA&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">                  start_month </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">4</span><span style="color:var(--shiki-color-text);">),</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">                  end_month   </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">6</span><span style="color:var(--shiki-color-text);">)) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Rolling join that catches everything between the distinct</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># start and end dates for each carrier.</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[dat3, on </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">carrier,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">                 month </span><span style="color:var(--shiki-token-keyword);">&gt;=</span><span style="color:var(--shiki-token-punctuation);"> start_month,</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">                 month </span><span style="color:var(--shiki-token-keyword);">&lt;=</span><span style="color:var(--shiki-token-punctuation);"> end_month</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">] </span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div></div><h4 id="rolling-joins" tabindex="-1"><a class="header-anchor" href="#rolling-joins" aria-hidden="true">#</a> Rolling Joins</h4><p>Rolling joins are similar and allow you to match a set of dates forwards or backwards. For example, our <code>dat</code> dataset ends in October. Let&#39;s say we want to carry the last known entries for American and United Airlines forward to (random) future dates.</p><div class="code--container grid-cols-1"><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Make sure we have a date variable</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, date </span><span style="color:var(--shiki-token-keyword);">:=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">as.IDate(paste</span><span style="color:var(--shiki-token-punctuation);">(year, month, day, sep</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;-&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)] </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># New DT with the (random) target dates</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat4 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">data.table(</span><span style="color:var(--shiki-token-punctuation);">carrier  = </span><span style="color:var(--shiki-token-function);">c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;AA&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;UA&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">,</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">                  new_date </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">as.IDate(c</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;2014-11-01&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;2014-11-15&#39;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)) </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Join on these target dates, so they take the last known value </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[dat4, on </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">.(</span><span style="color:var(--shiki-token-punctuation);">carrier, date</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);">new_date</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, roll</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;nearest&#39;</span><span style="color:var(--shiki-color-text);">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div>`,48);function qs(Ss,Rs){const n=l("ExternalLinkIcon");return t(),i(p,null,[k,s("p",null,[s("a",y,[h,o(n)]),v,d,u,m,b]),x,s("p",null,[g,s("a",w,[f,o(n)]),_]),q,s("p",null,[S,R,D,s("a",A,[N,o(n)]),T,I,L,E,U,M,C,Y,j,G,B]),F,s("p",null,[H,O,J,W,P,s("a",K,[V,o(n)]),z,$,Q]),X,s("div",Z,[ss,s("div",null,[s("p",null,[s("em",null,[as,s("a",ns,[os,o(n)]),es])])])]),rs,s("div",ls,[ts,s("div",null,[s("p",null,[s("em",null,[is,s("a",ps,[cs,o(n)]),ks])])])]),ys,s("p",null,[hs,vs,ds,s("a",us,[ms,o(n)]),bs,xs,gs,ws,fs]),_s],64)}var As=r(c,[["render",qs]]);export{As as default};
