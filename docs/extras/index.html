<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.33">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro"><title>extras | Stata2R</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.75b960f8.js"><link rel="modulepreload" href="/assets/index.html.25b0cd40.js"><link rel="modulepreload" href="/assets/index.html.e37aa3e6.js">
    <link rel="stylesheet" href="/assets/style.3edb955c.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">Stata2R</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/stata2r/stata2r.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/stata2r/stata2r.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/data.table/" class="sidebar-item sidebar-heading" aria-label="data.table"><!--[--><!--]--> data.table <!--[--><!--]--></a><!----></li><li><a href="/fixest/" class="sidebar-item sidebar-heading" aria-label="fixest"><!--[--><!--]--> fixest <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="extras"><!--[--><!--]--> extras <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/extras/#base" class="router-link-active router-link-exact-active sidebar-item" aria-label="base"><!--[--><!--]--> base <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#ggplot2" class="router-link-active router-link-exact-active sidebar-item" aria-label="ggplot2"><!--[--><!--]--> ggplot2 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#tidyverse" class="router-link-active router-link-exact-active sidebar-item" aria-label="tidyverse"><!--[--><!--]--> tidyverse <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#collapse" class="router-link-active router-link-exact-active sidebar-item" aria-label="collapse"><!--[--><!--]--> collapse <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#sandwich" class="router-link-active router-link-exact-active sidebar-item" aria-label="sandwich"><!--[--><!--]--> sandwich <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#modelsummary" class="router-link-active router-link-exact-active sidebar-item" aria-label="modelsummary"><!--[--><!--]--> modelsummary <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#marginaleffects" class="router-link-active router-link-exact-active sidebar-item" aria-label="marginaleffects"><!--[--><!--]--> marginaleffects <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#lme4" class="router-link-active router-link-exact-active sidebar-item" aria-label="lme4"><!--[--><!--]--> lme4 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/extras/#sf" class="router-link-active router-link-exact-active sidebar-item" aria-label="sf"><!--[--><!--]--> sf <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="other-packages" tabindex="-1"><a class="header-anchor" href="#other-packages" aria-hidden="true">#</a> Other Packages</h1><p>While we think you can get really far in R with just <strong>data.table</strong> and <strong>fixest</strong>, of course these two packages don&#39;t cover everything.</p><p>This page covers a small list of packages you may find especially useful when getting started with R. We won&#39;t try to cover everything under the sun here. Just a few places to get going. For the rest, well, that&#39;s what StackOverflow or your favourite search engine is for.</p><p>All of the below packages have far more applications than is shown here. We&#39;ll just provide one or two examples of how each can be used. Finally, don&#39;t forget to install them with <code>install.packages(&#39;PKGNAME&#39;)</code> and load them with <code>library(PKGNAME)</code>. The former command you only have to run once per package (or as often as you want to update it); the latter whenever you want to use a package in a new R session.</p><h2 id="base" tabindex="-1"><a class="header-anchor" href="#base" aria-hidden="true">#</a> base</h2><p><em>Where it all begins</em></p><p>Like many programming languages, one of R&#39;s great strengths is its package ecosystem. But none of that would be possible without the scaffolding provided by <a href="https://www.r-project.org/about.html" target="_blank" rel="noopener noreferrer"><strong>base</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> R. The &quot;base&quot; part here represents a set of core libraries and routines that get installed and loaded automatically whenever you start an R session. And you really get a lot out of the gate, because base R is incredibly versatile and function rich. Many of the operations that we have shown you on the preceding pages could equally have been implemented using off-the-shelf base R equivalents. We won&#39;t attempt to persuade you of that here, but there are lots of good tutorials available if you&#39;re interested (<a href="https://github.com/matloff/fasteR#table-of-contents" target="_blank" rel="noopener noreferrer">here<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> for example). Below we&#39;ll just highlight a few simple examples to give you an idea.</p><h4 id="plotting-simple-histogram" tabindex="-1"><a class="header-anchor" href="#plotting-simple-histogram" aria-hidden="true">#</a> Plotting (simple histogram)</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">set</span><span style="color:var(--shiki-color-text);"> obs </span><span style="color:var(--shiki-token-constant);">100</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">gen</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rnormal</span><span style="color:var(--shiki-color-text);">()</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">histogram</span><span style="color:var(--shiki-color-text);"> x</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">rnorm</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">hist</span><span style="color:var(--shiki-color-text);">(x)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h4 id="linear-regression" tabindex="-1"><a class="header-anchor" href="#linear-regression" aria-hidden="true">#</a> Linear regression</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">reg</span><span style="color:var(--shiki-color-text);"> y x1 x2</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-color-text);">(y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> x1 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> x2, dat)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div></div><h4 id="iteration-loops" tabindex="-1"><a class="header-anchor" href="#iteration-loops" aria-hidden="true">#</a> Iteration (loops)</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">foreach</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">i</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">of numlist</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">/</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-keyword);">display</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">i</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">) {</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">print</span><span style="color:var(--shiki-color-text);">(i </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside 1: A single line works too here.</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">for</span><span style="color:var(--shiki-color-text);"> (i </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">print</span><span style="color:var(--shiki-color-text);">(i </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside 2: R provides &quot;functional programming&quot; eqivalents</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># to for-loops via the *apply family of functions. These</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># have various advantages, which we won&#39;t get into here.</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Still the most important member is arguably &quot;lapply&quot;, which </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># we&#39;ve already seen a couple of times and returns a list</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># result (which is great for programming). Here&#39;s the</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># equivalent lapply code to the previous for-loop.</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">lapply</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-token-constant);">10</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-keyword);">function</span><span style="color:var(--shiki-color-text);">(i) </span><span style="color:var(--shiki-token-function);">print</span><span style="color:var(--shiki-color-text);">(i </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div></div><h2 id="ggplot2" tabindex="-1"><a class="header-anchor" href="#ggplot2" aria-hidden="true">#</a> ggplot2</h2><p><em>Beautiful and customizable plots</em></p><p><a href="https://ggplot2.tidyverse.org/" target="_blank" rel="noopener noreferrer"><strong>ggplot2</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> is widely considered one of the preeminent plotting libraries available in any language. It provides an intuitive syntax that applies in the same way across many, many different kinds of visualizations, and with a deep level of customization. Plus, endless additional plugins to do what you want, including easy interactivity, animation, maps, etc. We thought about giving <strong>ggplot2</strong> its own dedicated page like <strong>data.table</strong> and <strong>fixest</strong>. But instead we&#39;ll point you to the <a href="https://lost-stats.github.io/Presentation/Figures/Figures.html" target="_blank" rel="noopener noreferrer">Figures<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> section of the <em>Library of Statistical Techniques</em>, which already shows how to do many different graphing tasks in both Stata and <strong>ggplot2</strong>. For a more in-depth overview you can always consult the excellent <a href="https://ggplot2.tidyverse.org/" target="_blank" rel="noopener noreferrer">package documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>, or Kieran Healy&#39;s wonderful <a href="https://socviz.co/" target="_blank" rel="noopener noreferrer"><em>Data Visualization</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> book.</p><h4 id="basic-scatterplot-s" tabindex="-1"><a class="header-anchor" href="#basic-scatterplot-s" aria-hidden="true">#</a> Basic scatterplot(s)</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">twoway</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">scatter</span><span style="color:var(--shiki-color-text);"> yvar xvar</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">twoway</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(scatter</span><span style="color:var(--shiki-color-text);"> yvar xvar </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> group </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">mc</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">blue</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">\\</span><span style="color:var(--shiki-color-text);">\</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-keyword);">(scatter</span><span style="color:var(--shiki-color-text);"> yvar xvar </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> group </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">2</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">mc</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">red</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-keyword);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">ggplot(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-function);">aes(</span><span style="color:var(--shiki-token-punctuation);">x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> xvar, y </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> yvar</span><span style="color:var(--shiki-token-function);">))</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">geom_point()</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">ggplot(</span><span style="color:var(--shiki-token-punctuation);">dat, </span><span style="color:var(--shiki-token-function);">aes(</span><span style="color:var(--shiki-token-punctuation);">x </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> xvar, y </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> yvar, color </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> group</span><span style="color:var(--shiki-token-function);">))</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">geom_point()</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><h2 id="tidyverse" tabindex="-1"><a class="header-anchor" href="#tidyverse" aria-hidden="true">#</a> tidyverse</h2><p><em>A family of data science tools</em></p><p>The <a href="https://www.tidyverse.org/" target="_blank" rel="noopener noreferrer"><strong>tidyverse</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> provides an extremely popular framework for data science tasks in R. This meta-package is actually a collection of smaller packages that are all designed to work together, based on a shared philosophy and syntax. We&#39;ve already covered <strong>ggplot2</strong> above, but there are plenty more. These include <strong>dplyr</strong> and <strong>tidyr</strong>, which offer an alternative syntax and approach to data wrangling tasks. While we personally recommend <strong>data.table</strong>, these <strong>tidyverse</strong> packages have many ardent fans too. You may find that you prefer their modular design and verbal syntax. But don&#39;t feel bound either way: it&#39;s totally fine to combine them. Some other <strong>tidyverse</strong> packages worth knowing about include <strong>purrr</strong>, which contains a suite of functions for automating and looping your work, <strong>lubridate</strong> which makes working with date-based data easy, and <strong>stringr</strong> which offers functions with straightforward syntax for working with string variables. In the examples that follow, note that <code>%&gt;%</code> is a <a href="https://magrittr.tidyverse.org/" target="_blank" rel="noopener noreferrer">pipe operator<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><h4 id="data-wrangling-with-dplyr" tabindex="-1"><a class="header-anchor" href="#data-wrangling-with-dplyr" aria-hidden="true">#</a> Data wrangling with dplyr</h4><p><em>Note: <strong>dplyr</strong> doesn&#39;t modify data in place. So you&#39;ll need to (re)assign if you want to keep your changes. E.g. <code>dat = dat %&gt;% group_by...</code></em></p><p>Subset by rows and then columns.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">if</span><span style="color:var(--shiki-color-text);"> var1</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">&quot;value&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">keep</span><span style="color:var(--shiki-color-text);"> var1 var2 var3</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">filter</span><span style="color:var(--shiki-color-text);">(var1</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">&quot;value&quot;</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">   </span><span style="color:var(--shiki-token-function);">select(</span><span style="color:var(--shiki-token-punctuation);">var1, var2, var3</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><p>Create a new variable by group.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">bysort</span><span style="color:var(--shiki-color-text);"> group1</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">egen</span><span style="color:var(--shiki-color-text);"> mean_var1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">var1</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">group_by(</span><span style="color:var(--shiki-token-punctuation);">group1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">mutate(</span><span style="color:var(--shiki-token-punctuation);">mean_var1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(var1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><p>Collapse by group.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> mean_var1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> var1, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">group1</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">group_by(</span><span style="color:var(--shiki-token-punctuation);">group1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">%&gt;%</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">  </span><span style="color:var(--shiki-token-function);">summarise(</span><span style="color:var(--shiki-token-punctuation);">mean_var1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-function);">mean</span><span style="color:var(--shiki-token-punctuation);">(var1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><h4 id="manipulating-dates-with-lubridate" tabindex="-1"><a class="header-anchor" href="#manipulating-dates-with-lubridate" aria-hidden="true">#</a> Manipulating dates with lubridate</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Shift a date forward one month (not 30 days, one month)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* ???</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Shift a date forward one month (not 30 days, one month)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">shifted_date </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> date </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">months</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h4 id="iterating-with-purrr" tabindex="-1"><a class="header-anchor" href="#iterating-with-purrr" aria-hidden="true">#</a> Iterating with purrr</h4><p>Read in many files and append them together.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">local</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">filelist</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">dir</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;data/&quot;</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">files</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;*.csv&quot;</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">tempfile</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">mytmpfile</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, replace empty</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">foreach</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">of local</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">filelist</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">{</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">qui:</span><span style="color:var(--shiki-color-text);"> import delimited </span><span style="color:var(--shiki-token-string-expression);">&quot;data/`</span><span style="color:var(--shiki-token-function);">x</span><span style="color:var(--shiki-token-string-expression);">&#39;&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">case</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">preserve</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-keyword);">clear</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">append</span><span style="color:var(--shiki-color-text);"> using </span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">	</span><span style="color:var(--shiki-token-keyword);">save</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">mytmpfile</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-color-text);">, replace</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">filelist </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">dir</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;data/&quot;</span><span style="color:var(--shiki-color-text);">, pattern</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&quot;.csv<!--vuepress-ssr-app-->quot;</span><span style="color:var(--shiki-color-text);">, full.names</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">TRUE</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">map_df(</span><span style="color:var(--shiki-token-punctuation);">filelist, data.table</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-punctuation);">fread</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Note: map_*df* means map (iterate) then coerce the</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># result to a data frame</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>Iterate over variables.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">ds</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">has</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">type</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">long</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">r</span><span style="color:var(--shiki-token-comment);">(varlist)</span><span style="color:var(--shiki-color-text);">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Note: map is a stand-in replacement for lapply</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">dat[, </span><span style="color:var(--shiki-token-function);">map(</span><span style="color:var(--shiki-token-punctuation);">.SD, mean</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">, .SDcols</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">is.numeric]</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h4 id="string-operations-with-stringr" tabindex="-1"><a class="header-anchor" href="#string-operations-with-stringr" aria-hidden="true">#</a> String operations with stringr</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">subinstr</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;world&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;universe&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">.</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">substr</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">regexm</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-color-text);">&quot;</span><span style="color:var(--shiki-token-string-expression);">ello</span><span style="color:var(--shiki-color-text);">&quot;</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">str_replace_all(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;world&quot;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;universe&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">str_sub(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-constant);">3</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">str_detect(</span><span style="color:var(--shiki-token-string-expression);">&quot;Hello world&quot;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&quot;ello&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Note all the stringr functions accept regex input</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div></div><h2 id="collapse" tabindex="-1"><a class="header-anchor" href="#collapse" aria-hidden="true">#</a> collapse</h2><p><em>Extra convenience functions and super fast aggregations</em></p><p>Sure, we&#39;ve gone on and on about how fast <strong>data.table</strong> is compared to just about everything else. But there is another R package that can boast even faster computation times for certain grouped calculations and transformations, and that&#39;s <a href="https://sebkrantz.github.io/collapse/index.html" target="_blank" rel="noopener noreferrer">collapse<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>. The <strong>collapse</strong> package doesn&#39;t try to do everything that <strong>data.table</strong> does. But the two <a href="https://sebkrantz.github.io/collapse/articles/collapse_and_data.table.html" target="_blank" rel="noopener noreferrer">play very well together<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> and the former offers some convenience functions like <code>descr</code> and <code>collap</code>, which essentially mimic the equivalent functions in Stata and might be particularly appealing to readers of this guide. (P.S. If you&#39;d like to load <strong>data.table</strong> and <strong>collapse</strong> at the same time, plus some other high-performance packages, check out the <a href="https://sebkrantz.github.io/fastverse/index.html" target="_blank" rel="noopener noreferrer"><strong>fastverse</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.)</p><h4 id="quick-summaries" tabindex="-1"><a class="header-anchor" href="#quick-summaries" aria-hidden="true">#</a> Quick Summaries</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">summarize</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">describe</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">qsu(</span><span style="color:var(--shiki-token-punctuation);">dat</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">descr(</span><span style="color:var(--shiki-token-punctuation);">dat</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h4 id="multiple-grouped-aggregations" tabindex="-1"><a class="header-anchor" href="#multiple-grouped-aggregations" aria-hidden="true">#</a> Multiple grouped aggregations</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(mean)</span><span style="color:var(--shiki-color-text);"> var1, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">group1</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">collapse</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">min</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> min_var1</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">var1 min_var2</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">var2 </span><span style="color:var(--shiki-token-keyword);">(</span><span style="color:var(--shiki-color-text);">max</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);"> max_var1</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">var1 max_var2</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">var2, </span><span style="color:var(--shiki-token-function);">by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">group1</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-parameter);">group2</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-function);">collap(</span><span style="color:var(--shiki-token-punctuation);">dat, var1 </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> group1, fmean</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># &#39;fmean&#39; =&gt; fast mean</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">collap(</span><span style="color:var(--shiki-token-punctuation);">dat, var1 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> var2 </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> group1 </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> group2, FUN </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(fmin, fmax)</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div></div><h2 id="sandwich" tabindex="-1"><a class="header-anchor" href="#sandwich" aria-hidden="true">#</a> sandwich</h2><p><em>More standard error adjustments</em></p><p><strong>fixest</strong> package comes with plenty of shortcuts for accessing standard error adjustments like HC1 heteroskedasticity-robust standard errors, Newey-West, Driscoll-Kraay, clustered standard errors, etc. But of course there are still more than that. A host of additional options are covered by the <a href="https://sandwich.r-forge.r-project.org/" target="_blank" rel="noopener noreferrer"><strong>sandwich</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> package, which comes with a long list of functions like <code>vcovBS()</code> for bootstrapped standard errors, or <code>vcovHC()</code> for HC1-5. <strong>sandwich</strong> supports nearly every model class in R, so it shouldn&#39;t surprise that these can slot right into <code>fixest</code> estimates, too. You shouldn&#39;t be using those <code>, robust</code> errors for smaller samples anyway... but you <a href="http://datacolada.org/99" target="_blank" rel="noopener noreferrer">knew that<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>, right?</p><h4 id="linear-model-adjustments" tabindex="-1"><a class="header-anchor" href="#linear-model-adjustments" aria-hidden="true">#</a> Linear Model Adjustments</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* &quot;, robust&quot; uses hc1 which isn&#39;t great for small samples</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">regress</span><span style="color:var(--shiki-color-text);"> Y X Z, </span><span style="color:var(--shiki-token-function);">vce</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">hc3</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># sandwich&#39;s vcovHC uses HC3 by default</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">feols(</span><span style="color:var(--shiki-token-punctuation);">Y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> X </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> Z, dat, vcov </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> sandwich</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-token-punctuation);">vcovHC</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Aside: Remember that you can also adjust the SEs </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># for existing models on the fly </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">m </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">feols(</span><span style="color:var(--shiki-token-punctuation);">Y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> X </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> Z, dat</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">summary</span><span style="color:var(--shiki-color-text);">(m, vcov </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> sandwich</span><span style="color:var(--shiki-token-keyword);">::</span><span style="color:var(--shiki-color-text);">vcovHC)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><h2 id="modelsummary" tabindex="-1"><a class="header-anchor" href="#modelsummary" aria-hidden="true">#</a> modelsummary</h2><p><em>Summary tables, regression tables, and more</em></p><p>The <strong>fixest</strong> package already has the <code>etable()</code> function for generating regression tables. However, it is only really intended to work with models from the same package. So we also recommend checking out the fantastic <a href="https://vincentarelbundock.github.io/modelsummary" target="_blank" rel="noopener noreferrer"><strong>modelsummary</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> package. It works with all sorts of model objects, including those not from <strong>fixest</strong>, is incredibly customizable, and outputs to a bunch of different formats (PDF, HTML, DOCX, etc.) Similarly, <strong>modelsummary</strong> has a wealth of options for producing publication-ready summary tables. Oh, and it produces coefficient plots too. Check out the <a href="https://vincentarelbundock.github.io/modelsummary/" target="_blank" rel="noopener noreferrer">package website<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> for more.</p><h4 id="summary-tables" tabindex="-1"><a class="header-anchor" href="#summary-tables" aria-hidden="true">#</a> Summary tables</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Summary stats table </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">estpost</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">summarize</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">cells</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;count mean sd min max&quot;</span><span style="color:var(--shiki-color-text);">) nomtitle nonumber </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Balance table </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">by</span><span style="color:var(--shiki-color-text);"> treat_var</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">eststo:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">estpost</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">summarize</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">cells</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;mean sd&quot;</span><span style="color:var(--shiki-color-text);">) label nodepvar</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># Summary stats table </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">datasummary_skim(</span><span style="color:var(--shiki-token-punctuation);">dat</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Balance table </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">datasummary_balance(</span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);">treat_var, dat</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div><h4 id="regression-tables" tabindex="-1"><a class="header-anchor" href="#regression-tables" aria-hidden="true">#</a> Regression tables</h4><p><strong>Aside:</strong> Here we&#39;ll use the base R <code>lm()</code> (linear model) function, rather than <code>feols()</code>, to emphasize that <strong>modelsummary</strong> works with many different model classes.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">reg</span><span style="color:var(--shiki-color-text);"> Y X Z </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">eststo</span><span style="color:var(--shiki-color-text);"> est1 </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);"> est1b</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">reg</span><span style="color:var(--shiki-color-text);"> Y X Z, </span><span style="color:var(--shiki-token-function);">vce</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">hc3</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">eststo</span><span style="color:var(--shiki-color-text);"> est1b </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);"> est1b </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);"> est1 est1b</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">reg</span><span style="color:var(--shiki-color-text);"> Y X Z A, </span><span style="color:var(--shiki-token-function);">vce</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">hc3</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">eststo</span><span style="color:var(--shiki-color-text);"> est2</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">esttab</span><span style="color:var(--shiki-color-text);"> est1 est1b est2</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">est1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-color-text);">(Y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> X </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> Z, dat) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">msummary(</span><span style="color:var(--shiki-token-punctuation);">est1</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-comment);"># msummary() = alias for modelsummary()</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Like fixest::etable(), SEs for existing models can</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># be adjusted on-the-fly </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">msummary(</span><span style="color:var(--shiki-token-punctuation);">est1, vcov</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">&#39;hc3&#39;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Multiple SEs for the same model</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">msummary(</span><span style="color:var(--shiki-token-punctuation);">est1, vcov</span><span style="color:var(--shiki-token-keyword);">=list</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;iid&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;hc3&#39;</span><span style="color:var(--shiki-token-punctuation);">)</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-color-text);">est3 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-color-text);">(Y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> X </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> Z </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> A, dat) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">msummary(</span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(est1, est1, est3),</span></span>
<span class="line"><span style="color:var(--shiki-token-punctuation);">         vcov </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-keyword);">list</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&#39;iid&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;hc3&#39;</span><span style="color:var(--shiki-token-punctuation);">, </span><span style="color:var(--shiki-token-string-expression);">&#39;hc3&#39;</span><span style="color:var(--shiki-token-punctuation);">)</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div></div><h2 id="marginaleffects" tabindex="-1"><a class="header-anchor" href="#marginaleffects" aria-hidden="true">#</a> marginaleffects</h2><p><em>Marginal effects, contrasts, joint hypothesis tests, etc.</em></p><p>The Stata <code>margins</code> command is great. To replicate it in R, we highly recommend the <a href="https://vincentarelbundock.github.io/marginaleffects/" target="_blank" rel="noopener noreferrer"><strong>marginaleffects</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> package. Individual marginal effects or average marginal effects for nonlinear models, or models with interactions or transformations, etc. The documentation is outstanding and the underlying functions are also very fast.</p><h4 id="marginal-effects-and-plots" tabindex="-1"><a class="header-anchor" href="#marginal-effects-and-plots" aria-hidden="true">#</a> Marginal effects and plots</h4><p>Here&#39;s a simple example of a hypothetical logit model.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">logit</span><span style="color:var(--shiki-color-text);"> y x z</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">margins, </span><span style="color:var(--shiki-token-function);">dydx</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Predictive plot example</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">levelsof</span><span style="color:var(--shiki-color-text);"> x, miss </span><span style="color:var(--shiki-token-function);">local</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x_lvls</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">qui</span><span style="color:var(--shiki-color-text);"> margins, </span><span style="color:var(--shiki-token-function);">at</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x</span><span style="color:var(--shiki-token-keyword);">=(</span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">x_lvls</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">marginsplot, </span><span style="color:var(--shiki-token-function);">recast</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">line</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">recastci</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">rarea</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">m </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">glm</span><span style="color:var(--shiki-color-text);">(y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> z, family </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> binomial, data </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> some_data)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">summary</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">marginaleffects(</span><span style="color:var(--shiki-token-punctuation);">m</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Predictive plot example</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">plot_cap(</span><span style="color:var(--shiki-token-punctuation);">m, </span><span style="color:var(--shiki-token-string-expression);">&quot;x&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><p>And here&#39;s another of a hypothetical continuous * categorical interaction model.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* x is a continuous and z is categorical</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">reg</span><span style="color:var(--shiki-color-text);"> y </span><span style="color:var(--shiki-token-constant);">c.</span><span style="color:var(--shiki-color-text);">x</span><span style="color:var(--shiki-token-keyword);">##</span><span style="color:var(--shiki-token-constant);">i.</span><span style="color:var(--shiki-color-text);">z</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">qui</span><span style="color:var(--shiki-color-text);"> margins z, </span><span style="color:var(--shiki-token-function);">dydx</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">marginsplot</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">levelsof</span><span style="color:var(--shiki-color-text);"> x, miss </span><span style="color:var(--shiki-token-function);">local</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x_lvls</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">qui</span><span style="color:var(--shiki-color-text);"> margins, </span><span style="color:var(--shiki-token-function);">dydx</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">z</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">at</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">x</span><span style="color:var(--shiki-token-keyword);">=(</span><span style="color:var(--shiki-color-text);">`</span><span style="color:var(--shiki-token-function);">x_lvls</span><span style="color:var(--shiki-color-text);">&#39;</span><span style="color:var(--shiki-token-keyword);">)</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">marginsplot, </span><span style="color:var(--shiki-token-function);">recast</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">line</span><span style="color:var(--shiki-color-text);">) </span><span style="color:var(--shiki-token-function);">recastci</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-parameter);">rarea</span><span style="color:var(--shiki-color-text);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># X is a continuous and Z is categorical</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">m </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-color-text);">(y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">factor</span><span style="color:var(--shiki-color-text);">(z), some_data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">plot_cme(</span><span style="color:var(--shiki-token-punctuation);">m, effect </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;x&quot;</span><span style="color:var(--shiki-token-punctuation);">, condition </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;z&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-function);">plot_cme(</span><span style="color:var(--shiki-token-punctuation);">m, effect </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;z&quot;</span><span style="color:var(--shiki-token-punctuation);">, condition </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;x&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div></div><h4 id="joint-coefficient-and-non-linear-hypothesis-tests" tabindex="-1"><a class="header-anchor" href="#joint-coefficient-and-non-linear-hypothesis-tests" aria-hidden="true">#</a> Joint coefficient and (non)linear hypothesis tests</h4><p>Stata provides a number of inbuilt commands for (potentially complex) postestimation coefficient tests. We&#39;ve already seen the <code>testparm</code> command equivalent with <code>fixest::wald()</code>. But what about combinations of coefficients <em>a la</em> Stata&#39;s <code>lincom</code> and <code>nlcom</code> commands? While several R packages do this, we&#39;ll again recommend the <strong>marginaleffects</strong> package. It&#39;s lightweight and fast, and supports <a href="https://vincentarelbundock.github.io/marginaleffects/articles/hypothesis.html" target="_blank" rel="noopener noreferrer">hypothesis testing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> of both linear and non-linear combinations.</p><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">regress</span><span style="color:var(--shiki-color-text);"> y x z </span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Test linear combination of coefficients </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">lincom</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> z </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* Test nonlinear combination of coefficients </span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">nlcom</span><span style="color:var(--shiki-color-text);"> _b[x]/_b[z] </span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-color-text);">m </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">lm</span><span style="color:var(--shiki-color-text);">(y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-color-text);"> x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> z, dat)</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Test linear combination of coefficients </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">deltamethod(</span><span style="color:var(--shiki-token-punctuation);">m, </span><span style="color:var(--shiki-token-string-expression);">&quot;x + z = 0&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># marginaleffects(m, hypothesis = &quot;x + y = 0&quot;, newdata = &quot;mean&quot;) # same thing</span></span>
<span class="line"></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Test nonlinear combination of coefficients </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">deltamethod(</span><span style="color:var(--shiki-token-punctuation);">m, </span><span style="color:var(--shiki-token-string-expression);">&quot;x / z = 1&quot;</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># marginaleffects(m, hypothesis = &quot;x / y = 1&quot;, newdata = &quot;mean&quot;) # same thing</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div></div><h2 id="lme4" tabindex="-1"><a class="header-anchor" href="#lme4" aria-hidden="true">#</a> lme4</h2><p><em>Random effects and mixed models</em></p><p><strong>fixest</strong> can do a lot, but it can&#39;t do everything. This site isn&#39;t even going to attempt to go into how to translate every single model into R. But we&#39;ll quick highlight random-effects and mixed models. The <a href="https://cran.r-project.org/web/packages/lme4/index.html" target="_blank" rel="noopener noreferrer"><strong>lme4</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> and its <code>lmer()</code> function covers not just random-intercept models but also hierarchical models where slope coefficients follow random distributions. (<strong>Aside:</strong> If you prefer Bayesian models for this kind of thing, check out <a href="https://paul-buerkner.github.io/brms/" target="_blank" rel="noopener noreferrer"><strong>brms</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.)</p><h4 id="random-effects-and-mixed-models" tabindex="-1"><a class="header-anchor" href="#random-effects-and-mixed-models" aria-hidden="true">#</a> Random effects and mixed models</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-keyword);">xtset</span><span style="color:var(--shiki-color-text);"> group time</span></span>
<span class="line"><span style="color:var(--shiki-token-keyword);">xtreg</span><span style="color:var(--shiki-color-text);"> y x, re</span></span>
<span class="line"><span style="color:var(--shiki-color-text);">mixed y x </span><span style="color:var(--shiki-token-keyword);">||</span><span style="color:var(--shiki-color-text);"> group</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> x, reml</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># No need for an xtset equivalent</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">lmer(</span><span style="color:var(--shiki-token-punctuation);">y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> (</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-token-punctuation);"> group), data </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> dat</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"><span style="color:var(--shiki-token-function);">lmer(</span><span style="color:var(--shiki-token-punctuation);">y </span><span style="color:var(--shiki-token-keyword);">~</span><span style="color:var(--shiki-token-punctuation);"> x </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-punctuation);"> (x </span><span style="color:var(--shiki-token-keyword);">|</span><span style="color:var(--shiki-token-punctuation);"> group), data </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> dat</span><span style="color:var(--shiki-token-function);">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div><p>P.S. Take a look at the CRAN <a href="https://cran.r-project.org/web/views/Econometrics.html" target="_blank" rel="noopener noreferrer">Econometrics Task View<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> page for a thorough list of econometric methods and relevant packages.</p><h2 id="sf" tabindex="-1"><a class="header-anchor" href="#sf" aria-hidden="true">#</a> sf</h2><p><em>Geospatial operations</em></p><p>R has outstanding support for geospatial computation and mapping. There are a variety of packages to choose from here, depending on what you want (e.g. vector vs raster data, interactive maps, high-dimensional data cubes, etc.) But the workhorse geospatial tool for most R users is the incredibly versatile <a href="https://r-spatial.github.io/sf/" target="_blank" rel="noopener noreferrer"><strong>sf</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> package. We&#39;ll only provide a simple mapping example below. The <strong>sf</strong> <a href="https://r-spatial.github.io/sf/" target="_blank" rel="noopener noreferrer">website<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> has several in-depth tutorials, and we also recommend the <a href="https://geocompr.robinlovelace.net/" target="_blank" rel="noopener noreferrer"><em>Geocomputation with R</em><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> book by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow.</p><h4 id="simple-map" tabindex="-1"><a class="header-anchor" href="#simple-map" aria-hidden="true">#</a> Simple Map</h4><div class="code--container"><div><div class="language-stata ext-stata line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);">* Mapping in Stata requires the spmap and shp2dta </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* commands, and also that you convert your (say) </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* shapefile to .dta format first. We won&#39;t go through </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* all that here, but see: </span></span>
<span class="line"><span style="color:var(--shiki-token-comment);">* https://www.stata.com/support/faqs/graphics/spmap-and-maps/</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div><div class="language-r ext-r line-numbers-mode"><pre class="shiki" style="background-color:var(--shiki-color-background);"><code><span class="line"><span style="color:var(--shiki-token-comment);"># This example uses the North Carolina shapefile that is</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># bundled with the sf package. </span></span>
<span class="line"><span style="color:var(--shiki-color-text);">nc </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">st_read(system.file</span><span style="color:var(--shiki-token-punctuation);">(</span><span style="color:var(--shiki-token-string-expression);">&quot;shape/nc.shp&quot;</span><span style="color:var(--shiki-token-punctuation);">, package </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);"> </span><span style="color:var(--shiki-token-string-expression);">&quot;sf&quot;</span><span style="color:var(--shiki-token-function);">)</span><span style="color:var(--shiki-color-text);">) </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">plot</span><span style="color:var(--shiki-color-text);">(nc[, </span><span style="color:var(--shiki-token-string-expression);">&#39;BIR74&#39;</span><span style="color:var(--shiki-color-text);">])</span></span>
<span class="line"><span style="color:var(--shiki-token-comment);"># Or, if you have ggplot2 loaded: </span></span>
<span class="line"><span style="color:var(--shiki-token-function);">ggplot(</span><span style="color:var(--shiki-token-punctuation);">nc, </span><span style="color:var(--shiki-token-function);">aes(</span><span style="color:var(--shiki-token-punctuation);">fill</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-punctuation);">BIR74</span><span style="color:var(--shiki-token-function);">))</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">geom_sf()</span></span>
<span class="line"></span></code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div></div><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/stata2r/stata2r.github.io/edit/main/src/extras/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/fixest/" class="" aria-label="fixest"><!--[--><!--]--> fixest <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.75b960f8.js" defer></script>
  </body>
</html>
